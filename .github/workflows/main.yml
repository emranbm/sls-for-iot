---
name: "Main Workflow"
on:
  push:
    branches:
      - master
jobs:
  build-diagrams:
    runs-on: ubuntu-20.04
    container:
      image: think/plantuml:1.2020.5
      options: '--entrypoint ""'
    steps:
      - uses: actions/checkout@v2
      - run: java -jar /plantuml.jar design/diagrams/*.plnt
      - uses: actions/upload-artifact@v2
        with:
          name: Diagrams
          path: design/diagrams/*.png
  build-simulation-services:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - working-directory: simulation/
        run: cp -rf sls-types/ sls-shared-utils/ sls-manager/
      - working-directory: simulation/
        run: docker-compose build
  test:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
          cache: 'npm'
          cache-dependency-path: simulation/sls-sdk/package-lock.json
      - working-directory: simulation/sls-sdk/
        run: npm install
      - working-directory: simulation/sls-sdk/
        run: npm run test
  acceptance-test:
    name: Acceptance Test
    runs-on: ubuntu-20.04
    needs:
      - build-simulation-services
      - test
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
          cache: 'npm'
          cache-dependency-path: simulation/**/package-lock.json
      - working-directory: simulation/sls-sdk/
        run: npm install
      - working-directory: simulation/acceptance-test/
        run: npm install
      - working-directory: simulation/acceptance-test/
        run: npm run test
